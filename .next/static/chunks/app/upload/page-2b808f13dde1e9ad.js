(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[994],{6062:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>v});var r=a(5155),s=a(2115),n=a(4355),l=a(9869),i=a(9376),c=a(646),o=a(5339),d=a(2869),u=a(184),m=a(2730);async function p(e){let t=Date.now();try{let r,{getDocument:s}=await Promise.all([a.e(592),a.e(145)]).then(a.t.bind(a,7941,23));(await Promise.all([a.e(592),a.e(145)]).then(a.t.bind(a,7941,23))).GlobalWorkerOptions.workerSrc="//cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";let n=await s(e).promise,l="",i=0;for(let e=1;e<=n.numPages;e++){let t=await n.getPage(e),a=(await t.getTextContent()).items.map(e=>e.str?e.str:"").filter(e=>e.trim().length>0).join(" ");a.trim()&&(l+=a+"\n\n",i+=a.length)}let c=i/n.numPages,o=!1;0===i?(r="unreadable",o=!0):c<50?(r="poor",o=!0):r=c>200?"excellent":"good";let d=/\s{3,}/.test(l),u=/\b\w\s\w\s\w/.test(l);(d||u)&&(o=!0,"excellent"===r&&(r="good"));let m=Date.now()-t;return{text:l.trim(),pageCount:n.numPages,quality:r,isScanned:o,extractionTime:m}}catch(e){return console.error("PDF text extraction failed:",e),{text:"",pageCount:0,quality:"unreadable",isScanned:!0,extractionTime:Date.now()-t}}}async function h(e){let t=await p(e),a=[],r=[];"unreadable"===t.quality?(a.push("No text could be extracted from this PDF"),r.push("This appears to be a scanned image. Try rescanning at higher resolution"),r.push("Ensure the document is clear and well-lit when scanning")):"poor"===t.quality?(a.push("Limited text extracted - document may be low quality scan"),r.push("Try rescanning the document at 300 DPI or higher"),r.push("Ensure the document is flat and well-lit when scanning")):t.isScanned&&(a.push("Document appears to be scanned - text may have spacing issues"),r.push("For better accuracy, use the original digital document if available")),t.extractionTime>5e3&&(a.push("Document took a long time to process"),r.push("Consider using a smaller file size or fewer pages")),t.pageCount>5&&(a.push("Multi-page document detected"),r.push("For certificates, typically only the first page contains relevant information"));let s="unreadable"===t.quality||"poor"===t.quality&&t.isScanned;return{textQuality:t.quality,isScanned:t.isScanned,recommendsOCR:s,issues:a,suggestions:r}}var y=a(9617),x=a(7358);let f=new y.Ay({apiKey:x.env.NEXT_PUBLIC_OPENAI_API_KEY||"",dangerouslyAllowBrowser:!0});async function g(e){if(!x.env.NEXT_PUBLIC_OPENAI_API_KEY)throw Error("OpenAI API key not configured. Please set NEXT_PUBLIC_OPENAI_API_KEY environment variable.");try{var t,a;let r=null==(a=(await f.chat.completions.create({model:"gpt-4",messages:[{role:"system",content:"You are a professional certificate analysis assistant. Extract information accurately and return only valid JSON."},{role:"user",content:'\nAnalyze the following certificate text and extract key information.\nReturn ONLY a JSON object with these exact fields:\n\n{\n  "certificateName": "extracted name or null",\n  "issueDate": "YYYY-MM-DD or null",\n  "expiryDate": "YYYY-MM-DD or null", \n  "issuingAuthority": "authority name or null",\n  "certificateNumber": "number/serial or null",\n  "category": "STCW|GWO|OPITO|Contracts|Other",\n  "confidence": 0.95\n}\n\nCategory Guidelines:\n- STCW: Seafarer training (Basic Fire Fighting, Medical First Aid, Personnel Survival Techniques, Security)\n- GWO: Global Wind Organisation training (Basic Safety Training, etc.)\n- OPITO: Offshore petroleum industry training\n- Contracts: Employment contracts, agreements, work authorizations\n- Other: Everything else\n\nCertificate text:\n'.concat(e,"\n  ")}],temperature:.1,max_tokens:500})).choices[0])||null==(t=a.message)?void 0:t.content;if(!r)throw Error("No response from OpenAI API");let s=JSON.parse(r);return s.category&&["STCW","GWO","OPITO","Contracts","Other"].includes(s.category)||(s.category="Other"),("number"!=typeof s.confidence||s.confidence<0||s.confidence>1)&&(s.confidence=.5),s}catch(e){return console.error("Document analysis failed:",e),{certificateName:null,issueDate:null,expiryDate:null,issuingAuthority:null,certificateNumber:null,category:"Other",confidence:0}}}function v(){var e,t;let[a,y]=(0,s.useState)("collapsed"),[x,f]=(0,s.useState)(null),[v,N]=(0,s.useState)(null),[w,j]=(0,s.useState)(!1),[b,C]=(0,s.useState)(null),[O,D]=(0,s.useState)(null),S=(0,m.f)(e=>e.addCertificate),P=async e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];if(a&&"application/pdf"===a.type){f(a);let e=URL.createObjectURL(a);N(e),await A(e,a.name)}},A=async(e,t)=>{j(!0);try{let a=await p(e),r=await h(e);if(D(r),a.text.length>0){let e=await g(a.text);C({...e,extraction:a,fileName:t.replace(".pdf","")})}else C({certificateName:t.replace(".pdf",""),category:"Other",confidence:0,extraction:a,fileName:t.replace(".pdf","")})}catch(e){console.error("AI analysis failed:",e),C({certificateName:t.replace(".pdf",""),category:"Other",confidence:0,fileName:t.replace(".pdf","")})}finally{j(!1)}},k=()=>{x&&v&&(S({name:x.name.replace(".pdf",""),category:"Other",filePath:"/certificates/".concat(x.name),issueDate:new Date().toISOString().split("T")[0],expiryDate:new Date(Date.now()+31536e6).toISOString().split("T")[0],serialNumber:"CERT-".concat(Date.now()),status:"valid",pdfUrl:v}),window.location.href="/")};return(0,r.jsxs)("div",{className:"min-h-screen p-6 pb-32",children:[(0,r.jsxs)("div",{className:"max-w-sm mx-auto space-y-6",children:[(0,r.jsx)("div",{className:"flex items-center justify-between",children:(0,r.jsx)("h1",{className:"text-2xl font-semibold",style:{color:"var(--white-pure)"},children:"Upload Certificate"})}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)(d.$,{onClick:()=>{alert("Camera scanning will be implemented in Phase 2")},className:"w-full py-8 flex-col gap-3",style:{backgroundColor:"var(--grey-700)",color:"var(--white-pure)",border:"2px solid var(--grey-500)"},children:[(0,r.jsx)(n.A,{size:32}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-semibold",children:"Scan Document"}),(0,r.jsx)("div",{className:"text-sm opacity-75",children:"Use camera to scan certificate"})]})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:"file",accept:".pdf",onChange:P,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",id:"file-upload"}),(0,r.jsx)(d.$,{asChild:!0,className:"w-full py-8 flex-col gap-3",style:{backgroundColor:"var(--grey-700)",color:"var(--white-pure)",border:"2px solid var(--grey-500)"},children:(0,r.jsxs)("label",{htmlFor:"file-upload",className:"cursor-pointer",children:[(0,r.jsx)(l.A,{size:32}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-semibold",children:"Upload PDF"}),(0,r.jsx)("div",{className:"text-sm opacity-75",children:"Select PDF file from device"})]})]})})]})]}),x&&(0,r.jsxs)("div",{className:"p-4 rounded-lg space-y-4",style:{backgroundColor:"var(--grey-700)"},children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium",style:{color:"var(--white-pure)"},children:x.name}),(0,r.jsxs)("p",{className:"text-sm",style:{color:"var(--grey-500)"},children:[(x.size/1024/1024).toFixed(2)," MB"]})]}),w&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(i.A,{className:"animate-pulse",size:20,color:"var(--gold-accent)"}),(0,r.jsx)("span",{className:"text-sm",style:{color:"var(--gold-accent)"},children:"Analyzing..."})]})]}),O&&(0,r.jsxs)("div",{className:"p-3 rounded border",style:{backgroundColor:"var(--grey-900)",borderColor:"excellent"===O.textQuality?"var(--success-green)":"good"===O.textQuality?"var(--warn-amber)":"var(--error-red)"},children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:["excellent"===O.textQuality?(0,r.jsx)(c.A,{size:16,color:"var(--success-green)"}):(0,r.jsx)(o.A,{size:16,color:"var(--warn-amber)"}),(0,r.jsxs)("span",{className:"text-sm font-medium",style:{color:"var(--white-pure)"},children:["Document Quality: ",O.textQuality]})]}),O.issues.length>0&&(0,r.jsx)("div",{className:"space-y-1",children:O.issues.map((e,t)=>(0,r.jsxs)("p",{className:"text-xs",style:{color:"var(--grey-500)"},children:["â€¢ ",e]},t))})]}),b&&!w&&(0,r.jsxs)("div",{className:"p-3 rounded border space-y-3",style:{backgroundColor:"var(--grey-900)",borderColor:"var(--gold-accent)"},children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(i.A,{size:16,color:"var(--gold-accent)"}),(0,r.jsx)("span",{className:"text-sm font-medium",style:{color:"var(--white-pure)"},children:"AI Analysis Results"}),(null!=(e=b.confidence)?e:0)>0&&(0,r.jsxs)("span",{className:"text-xs px-2 py-1 rounded",style:{backgroundColor:"var(--gold-accent)",color:"var(--grey-900)"},children:[Math.round((null!=(t=b.confidence)?t:0)*100),"% confident"]})]}),(0,r.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{style:{color:"var(--grey-500)"},children:"Name: "}),(0,r.jsx)("span",{style:{color:"var(--white-pure)"},children:b.certificateName||"Not detected"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{style:{color:"var(--grey-500)"},children:"Category: "}),(0,r.jsx)("span",{style:{color:"var(--white-pure)"},children:b.category})]}),b.expiryDate&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{style:{color:"var(--grey-500)"},children:"Expiry: "}),(0,r.jsx)("span",{style:{color:"var(--white-pure)"},children:b.expiryDate})]}),b.certificateNumber&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{style:{color:"var(--grey-500)"},children:"Number: "}),(0,r.jsx)("span",{style:{color:"var(--white-pure)"},children:b.certificateNumber})]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(d.$,{onClick:()=>{if(!x||!v||!b)return;let e=new Date,t=new Date(e.getTime()+15768e7);S({name:b.certificateName||b.fileName||"Untitled Certificate",category:b.category||"Other",filePath:"/certificates/".concat(x.name),issueDate:b.issueDate||e.toISOString().split("T")[0],expiryDate:b.expiryDate||t.toISOString().split("T")[0],serialNumber:b.certificateNumber||"CERT-".concat(Date.now()),status:"valid",pdfUrl:v}),window.location.href="/"},className:"flex-1",style:{backgroundColor:"var(--gold-accent)",color:"var(--white-pure)"},children:"Accept AI Analysis"}),(0,r.jsx)(d.$,{onClick:k,className:"flex-1",style:{backgroundColor:"var(--grey-500)",color:"var(--white-pure)"},children:"Manual Entry"})]})]}),!b&&!w&&(0,r.jsx)(d.$,{onClick:k,className:"w-full",style:{backgroundColor:"var(--gold-accent)",color:"var(--white-pure)"},children:"Upload Manually"})]})]}),(0,r.jsx)(u.A,{onModeChange:y,mode:a})]})}},7257:(e,t,a)=>{Promise.resolve().then(a.bind(a,6062))},9387:e=>{"use strict";e.exports=canvas}},e=>{var t=t=>e(e.s=t);e.O(0,[921,134,151,645,441,684,358],()=>t(7257)),_N_E=e.O()}]);